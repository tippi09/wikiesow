



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Multi-purpose Raspbian setup - Coding</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#multi-purpose-raspbian-setup" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://saschakiesow.de" title="Coding" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Coding
            </span>
            <span class="md-header-nav__topic">
              Multi-purpose Raspbian setup
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/tippi09/wikiesow/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    tippi09/wikiesow
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Coding" class="md-nav__button md-logo">
      
        <img src="../../images/logo.png" width="48" height="48">
      
    </a>
    Coding
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/tippi09/wikiesow/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    tippi09/wikiesow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Coding Wiki" class="md-nav__link">
      Coding Wiki
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Raspberry Pi
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Raspberry Pi
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../irremote/" title="Improving Raspotify by configuring a LIRC IR remote (coming soon)" class="md-nav__link">
      Improving Raspotify by configuring a LIRC IR remote (coming soon)
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Multi-purpose Raspbian setup
      </label>
    
    <a href="./" title="Multi-purpose Raspbian setup" class="md-nav__link md-nav__link--active">
      Multi-purpose Raspbian setup
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#download-raspbian-image" title="Download Raspbian image" class="md-nav__link">
    Download Raspbian image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#write-image-to-the-sd-card" title="Write image to the SD Card" class="md-nav__link">
    Write image to the SD Card
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-user-and-root-password-settings" title="Default user and root password settings" class="md-nav__link">
    Default user and root password settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-raspbian-settings" title="General Raspbian settings" class="md-nav__link">
    General Raspbian settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-boot-configuration" title="Configure boot configuration" class="md-nav__link">
    Configure boot configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disable-hdmi-output" title="Disable HDMI output" class="md-nav__link">
    Disable HDMI output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-wifi-and-bluetooth" title="Disable WiFi and Bluetooth" class="md-nav__link">
    Disable WiFi and Bluetooth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-hifiberry-device-tree" title="Load HiFiBerry device tree" class="md-nav__link">
    Load HiFiBerry device tree
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-kodi" title="Configure Kodi" class="md-nav__link">
    Configure Kodi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-raspotify" title="Install Raspotify" class="md-nav__link">
    Install Raspotify
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ssh6/" title="Configure SSH over IPv6" class="md-nav__link">
      Configure SSH over IPv6
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      macOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        macOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/basic/" title="Basic macOS setup" class="md-nav__link">
      Basic macOS setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/bitbar/" title="BitBar: Menu bar plugins" class="md-nav__link">
      BitBar: Menu bar plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/uebersicht/" title="Übersicht: System monitor configuration" class="md-nav__link">
      Übersicht: System monitor configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#download-raspbian-image" title="Download Raspbian image" class="md-nav__link">
    Download Raspbian image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#write-image-to-the-sd-card" title="Write image to the SD Card" class="md-nav__link">
    Write image to the SD Card
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-user-and-root-password-settings" title="Default user and root password settings" class="md-nav__link">
    Default user and root password settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-raspbian-settings" title="General Raspbian settings" class="md-nav__link">
    General Raspbian settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-boot-configuration" title="Configure boot configuration" class="md-nav__link">
    Configure boot configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disable-hdmi-output" title="Disable HDMI output" class="md-nav__link">
    Disable HDMI output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-wifi-and-bluetooth" title="Disable WiFi and Bluetooth" class="md-nav__link">
    Disable WiFi and Bluetooth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-hifiberry-device-tree" title="Load HiFiBerry device tree" class="md-nav__link">
    Load HiFiBerry device tree
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-kodi" title="Configure Kodi" class="md-nav__link">
    Configure Kodi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-raspotify" title="Install Raspotify" class="md-nav__link">
    Install Raspotify
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/tippi09/wikiesow/edit/master/docs/Raspberry_Pi/semihead.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="multi-purpose-raspbian-setup">Multi-purpose Raspbian setup<a class="headerlink" href="#multi-purpose-raspbian-setup" title="Permanent link">&para;</a></h1>
<p>In this guide we will setup Raspbian on a Raspberry Pi so that it can be used for many purposes while keeping energy consumption as low as possible. Therefor we mainly run Raspbian headless and enable graphical output only if necessary (e.g. for media uses with Kodi).</p>
<h2 id="download-raspbian-image">Download Raspbian image<a class="headerlink" href="#download-raspbian-image" title="Permanent link">&para;</a></h2>
<p>First of all download the latest <strong>Raspbian Desktop</strong> image from <a href="https://www.raspberrypi.org/downloads/raspbian/">raspberrypi.org</a> <em>(Note: Do not use the Raspbian Lite image if you want to get graphical output as well)</em>.</p>
<p>Extract the zip file and remove it afterwards. Make sure to adjust the date if necessary:</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span> unzip <span class="m">2018</span>-11-13-raspbian-stretch.zip
<span class="gp">#</span> rm <span class="m">2018</span>-11-13-raspbian-stretch.zip
</pre></div>

<h2 id="write-image-to-the-sd-card">Write image to the SD Card<a class="headerlink" href="#write-image-to-the-sd-card" title="Permanent link">&para;</a></h2>
<p>To write the image we have to find our SD card first. On macOS we run <code class="codehilite">diskutil list</code> with the SD card still <strong>unplugged</strong>. Then you can insert the card and run <code class="codehilite">diskutil list</code> once more. You should see another device listed as a new entry just like this one:
<div class="codehilite"><pre><span></span>/dev/disk2 (internal, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:     FDisk_partition_scheme                        *32.0 GB   disk2
   1:                 DOS_FAT_32 LABEL                   32.0 GB   disk2s1
</pre></div></p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Make sure to <strong>replace the disk number</strong> (disk2 to disk#) corresponding to your <code class="codehilite">diskutil list</code> output before calling the following statements.</p>
</div>
<p>With the identifier of the SD card we can now unmount it before writing the image:
<div class="codehilite"><pre><span></span><span class="gp">#</span> diskutil unmountDisk /dev/disk2
</pre></div></p>
<p>Now use <code class="codehilite">dd</code> to write the image:</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span> sudo dd <span class="nv">bs</span><span class="o">=</span>1m <span class="k">if</span><span class="o">=</span><span class="m">2018</span>-11-13-raspbian-stretch.img <span class="nv">of</span><span class="o">=</span>/dev/rdisk2 <span class="nv">conv</span><span class="o">=</span>sync
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If this command fails you can try using <code class="codehilite">disk2</code> instead of <code class="codehilite">rdisk2</code>:
<div class="codehilite"><pre><span></span><span class="gp">#</span> sudo dd <span class="nv">bs</span><span class="o">=</span>1m <span class="k">if</span><span class="o">=</span><span class="m">2018</span>-11-13-raspbian-stretch.img <span class="nv">of</span><span class="o">=</span>/dev/disk2 <span class="nv">conv</span><span class="o">=</span>sync
</pre></div></p>
</div>
<p>After the <code class="codehilite">dd</code> command has finished writing the data you can eject the card:
<div class="codehilite"><pre><span></span><span class="gp">#</span> sudo diskutil eject /dev/rdisk2
</pre></div>
Now insert the SD card into your Raspberry and boot Raspbian for the first time.</p>
<h2 id="default-user-and-root-password-settings">Default user and root password settings<a class="headerlink" href="#default-user-and-root-password-settings" title="Permanent link">&para;</a></h2>
<p>After completing the initial configuration process you should enable SSH (if not already done) and login to your Raspberry via SSH. The default credentials are:
<div class="codehilite"><pre><span></span>    User: pi
Password: raspberry
</pre></div>
<div class="codehilite"><pre><span></span># ssh pi@raspberrypi
</pre></div>
First change the default root password by calling <code class="codehilite">passwd root</code> and create a new user for SSH access:
<div class="codehilite"><pre><span></span><span class="gp">#</span> adduser «user»
<span class="gp">#</span> usermod -a -G sudo «user»
</pre></div>
After testing sudo access with the created user the default user pi can be deleted:
<div class="codehilite"><pre><span></span><span class="gp">#</span> deluser -remove-home pi
</pre></div></p>
<h2 id="general-raspbian-settings">General Raspbian settings<a class="headerlink" href="#general-raspbian-settings" title="Permanent link">&para;</a></h2>
<p>A nice tool to easily adjust settings for Raspbian is the <code class="codehilite">raspi-config</code>. After using SSH to login to your Raspberry it can be started by calling:
<div class="codehilite"><pre><span></span><span class="gp">#</span> sudo raspi-config
</pre></div>
After running the aforementioned statement, navigate to <strong>Network Options -&gt; Hostname</strong>. Here you can change the default hostname <code class="codehilite">raspberrypi</code> to a new name you prefer.</p>
<p>Afterwards go to <strong>Boot Options -&gt; Desktop / CLI</strong> in <code class="codehilite">raspi-config</code>. Choose the console option to avoid booting the more expensive desktop mode after a restart.</p>
<h2 id="configure-boot-configuration">Configure boot configuration<a class="headerlink" href="#configure-boot-configuration" title="Permanent link">&para;</a></h2>
<p>Now we can configure some services and device trees to be loaded on boot. All the options in this section are set in the <code class="codehilite">/boot/config.txt</code> file:
<div class="codehilite"><pre><span></span><span class="gp">#</span> sudo vim /boot/config.txt
</pre></div></p>
<h3 id="disable-hdmi-output">Disable HDMI output<a class="headerlink" href="#disable-hdmi-output" title="Permanent link">&para;</a></h3>
<p>Do disable complete HDMI output on boot and avoid that the Raspberry turns on a connected TV with a HDMI-CEC event, add the following lines in your <code class="codehilite">config.txt</code>:
<div class="codehilite"><pre><span></span># uncomment to enable hdmi output on boot
hdmi_blanking=2
hdmi_ignore_cec_init=1
</pre></div></p>
<h3 id="disable-wifi-and-bluetooth">Disable WiFi and Bluetooth<a class="headerlink" href="#disable-wifi-and-bluetooth" title="Permanent link">&para;</a></h3>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Do not disable WiFi if you need it for SSH. Otherwise you could lock yourself out of your own system.</p>
</div>
<p>As I do not need the Bluetooth of my Raspberry and with it being connected to the internet via LAN, I turn off the WiFi and Bluetooth modules to save some energy by adding the following lines to my <code class="codehilite">config.txt</code>:
<div class="codehilite"><pre><span></span># uncomment to enable wifi and bluetooth
dtoverlay=pi3-disable-wifi
dtoverlay=pi3-disable-bt
</pre></div></p>
<h3 id="load-hifiberry-device-tree">Load HiFiBerry device tree<a class="headerlink" href="#load-hifiberry-device-tree" title="Permanent link">&para;</a></h3>
<p>As my HiFi system is connected to my Raspberry, I am using a HiFiBerry board for an improved sound experience. To load the correct device tree and disable the onboard, I added the following lines to my <code class="codehilite">config.txt</code>:
<div class="codehilite"><pre><span></span># Disabled onboard audio, loaded HiFiBerry device tree
# dtparam=audio=on
dtoverlay=hifiberry-dac
</pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The device tree that you have to load for your HiFiBerry depends on the concrete board you use. I am using a DAC+ DSP. For information of device trees for different models, take a look <a href="https://www.hifiberry.com/build/documentation/configuring-linux-3-18-x/">here</a>.</p>
</div>
<p>To check out which sound card is loaded, reboot and afterwards call:
<div class="codehilite"><pre><span></span><span class="gp">#</span> aplay -l
</pre></div>
You should see an output that looks something like this:
<div class="codehilite"><pre><span></span>**** Liste der Hardware-Geräte (PLAYBACK) ****
Karte 0: sndrpihifiberry [snd_rpi_hifiberry_dac], Gerät 0: HifiBerry DAC HiFi pcm5102a-hifi-0 []
  Sub-Geräte: 1/1
  Sub-Gerät #0: subdevice #0
</pre></div></p>
<h2 id="configure-kodi">Configure Kodi<a class="headerlink" href="#configure-kodi" title="Permanent link">&para;</a></h2>
<p>Because of the fact that HDMI output per default is disabled in this configuration, we have to find a way to bring it on when starting Kodi. For that reason, I wrote a small script called <code class="codehilite">kodi.sh</code>, that enables me to start Kodi via SSH:
<div class="codehilite"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;start&quot;</span> <span class="o">]</span> <span class="c1"># Start Kodi, turn TV on and change TV output to Pi input</span>
<span class="k">then</span>
    vcgencmd display_power <span class="m">1</span>
    <span class="nv">POWERSTATUS</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;pow 0&quot;</span> <span class="p">|</span> cec-client -s -d <span class="m">1</span><span class="k">)</span><span class="s2">&quot;</span>
    <span class="k">case</span> <span class="s2">&quot;</span><span class="nv">$POWERSTATUS</span><span class="s2">&quot;</span> in
        *standby* <span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;on 0&quot;</span> <span class="p">|</span> cec-client -s
                <span class="nb">echo</span> <span class="s2">&quot;as&quot;</span> <span class="p">|</span> cec-client RPI -s -d <span class="m">1</span><span class="p">;;</span>
        *off* <span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;on 0&quot;</span> <span class="p">|</span> cec-client -s
                <span class="nb">echo</span> <span class="s2">&quot;as&quot;</span> <span class="p">|</span> cec-client RPI -s -d <span class="m">1</span><span class="p">;;</span>
        *on* <span class="o">)</span> <span class="nb">echo</span> <span class="nb">echo</span> <span class="s2">&quot;as&quot;</span> <span class="p">|</span> cec-client RPI -s -d <span class="m">1</span><span class="p">;;</span>
        * <span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;Error: Unknown TV power status&quot;</span>
    <span class="k">esac</span>
    nohup kodi <span class="p">&amp;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;stopkodi&quot;</span> <span class="o">]</span> <span class="c1"># Stop Kodi and disable Pi HDMI output again</span>
<span class="k">then</span>
    vcgencmd display_power <span class="m">0</span>
    pkill kodi
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;stopkodiandtv&quot;</span> <span class="o">]</span> <span class="c1"># Stop Kodi, disable PI HDMI output and set TV to standby</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;standby 0&quot;</span> <span class="p">|</span> cec-client -s
    vcgencmd display_power <span class="m">0</span>
    pkill kodi
<span class="k">fi</span>
</pre></div>
After creating the script you have to make it executable by running:
<div class="codehilite"><pre><span></span><span class="gp">#</span> chmod +x /path/to/kodi.sh
</pre></div>
As the script has to be run with <code class="codehilite">sudo</code>, we have to enable your user to do so by editing the <code class="codehilite">/etc/sudoers.tmp</code> file:
<div class="codehilite"><pre><span></span><span class="gp">#</span>  sudo visudo
</pre></div>
Add the following line:
<div class="codehilite"><pre><span></span>«user» ALL= NOPASSWD: /path/to/kodi.sh
</pre></div>
Now it should be possible to run the script by running:
<div class="codehilite"><pre><span></span><span class="gp">#</span>  ssh -t «user»@«hostname» <span class="s2">&quot;sudo /path/to/kodi.sh «option»&quot;</span>
</pre></div>
With the following options available:</p>
<ul>
<li><strong>start</strong> Starts Kodi, turns the TV on if necessary by checking the current power status and changes the TV output to the Pis input.</li>
<li><strong>stopkodi</strong> Stops Kodi, disables the Pis HDMI output once again and keeps the TV turned on (in case you want to use it differently).</li>
<li><strong>stopkodiandtv</strong> Stops Kodi, disables the Pis HDMI output once again and turns the TV into standby mode.</li>
</ul>
<p>As a result, just run the following command to start Kodi:
<div class="codehilite"><pre><span></span><span class="gp">#</span>  ssh -t «user»@«hostname» <span class="s2">&quot;sudo /path/to/kodi.sh start&quot;</span>
</pre></div>
To make starting and stopping Kodi from my Mac easier, I have also written a script for <a href="https://getbitbar.com">Bitbar</a>. My BitBar setup is documented <a href="../../macOS/bitbar/">here</a> as well. If you have problems with the Kodi output, update Kodi and check your overscan options in <code class="codehilite">/boot/config.txt</code>.</p>
<h2 id="install-raspotify">Install Raspotify<a class="headerlink" href="#install-raspotify" title="Permanent link">&para;</a></h2>
<p>If you would like to use your Raspberry Pi as a Spotify connect client, it is recommended to use the <a href="https://dtcooper.github.io/raspotify/">Raspotify</a> project. To install Raspotify we use the provided install script:
<div class="codehilite"><pre><span></span><span class="gp">#</span> curl -L https://dtcooper.github.io/raspotify/install.sh &gt; raspotify.sh
<span class="gp">#</span> chmod +x raspotify.sh
</pre></div>
If you are certain that the script is harmless, run it:
<div class="codehilite"><pre><span></span><span class="gp">#</span> ./raspotify.sh
</pre></div>
To configure your Spotify client, just edit the <code class="codehilite">/etc/default/raspotify</code> file. For example, I changed the clients device name and the bitrate to higher quality by adding the lines:
<div class="codehilite"><pre><span></span>DEVICE_NAME=&quot;HiFiPi&quot; # default is raspotify
BITRATE=&quot;320&quot;        # default is 160
</pre></div></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../irremote/" title="Improving Raspotify by configuring a LIRC IR remote (coming soon)" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Improving Raspotify by configuring a LIRC IR remote (coming soon)
              </span>
            </div>
          </a>
        
        
          <a href="../ssh6/" title="Configure SSH over IPv6" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Configure SSH over IPv6
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019 Sascha Kiesow
          </div>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>