



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>SSH over IPv6 - Coding</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#ssh-over-ipv6" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://saschakiesow.de" title="Coding" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Coding
            </span>
            <span class="md-header-nav__topic">
              SSH over IPv6
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/tippi09/wikiesow/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    tippi09/wikiesow
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Coding" class="md-nav__button md-logo">
      
        <img src="../../images/logo.png" width="48" height="48">
      
    </a>
    Coding
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/tippi09/wikiesow/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    tippi09/wikiesow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Coding Wiki" class="md-nav__link">
      Coding Wiki
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Raspberry Pi
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Raspberry Pi
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../irremote/" title="Improving Raspotify by configuring a LIRC IR remote (coming soon)" class="md-nav__link">
      Improving Raspotify by configuring a LIRC IR remote (coming soon)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openvpn/" title="OpenVPN over IPv6" class="md-nav__link">
      OpenVPN over IPv6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../semihead/" title="Multi-purpose Raspbian setup" class="md-nav__link">
      Multi-purpose Raspbian setup
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        SSH over IPv6
      </label>
    
    <a href="./" title="SSH over IPv6" class="md-nav__link md-nav__link--active">
      SSH over IPv6
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#raspberry-pi-settings" title="Raspberry Pi settings" class="md-nav__link">
    Raspberry Pi settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#router-settings" title="Router settings" class="md-nav__link">
    Router settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-dynamic-dns-optional" title="Configure Dynamic DNS (optional)" class="md-nav__link">
    Configure Dynamic DNS (optional)
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sshfs/" title="SSHFS hard drive sharing" class="md-nav__link">
      SSHFS hard drive sharing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      macOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        macOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/basic/" title="Basic macOS setup" class="md-nav__link">
      Basic macOS setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/bitbar/" title="BitBar: Menu bar plugins" class="md-nav__link">
      BitBar: Menu bar plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/uebersicht/" title="Übersicht: System monitor configuration" class="md-nav__link">
      Übersicht: System monitor configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#raspberry-pi-settings" title="Raspberry Pi settings" class="md-nav__link">
    Raspberry Pi settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#router-settings" title="Router settings" class="md-nav__link">
    Router settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-dynamic-dns-optional" title="Configure Dynamic DNS (optional)" class="md-nav__link">
    Configure Dynamic DNS (optional)
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/tippi09/wikiesow/edit/master/docs/Raspberry_Pi/ssh6.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="ssh-over-ipv6">SSH over IPv6<a class="headerlink" href="#ssh-over-ipv6" title="Permanent link">&para;</a></h1>
<p>In this guide we will configure SSH on a Raspberry Pi so that it can be reached via IPv6 even from an outside network. This is especially useful if your ISP only grants a Dual-Stack Lite connection.</p>
<h2 id="raspberry-pi-settings">Raspberry Pi settings<a class="headerlink" href="#raspberry-pi-settings" title="Permanent link">&para;</a></h2>
<p>At first we have to enable the Pis IPv6-module by editing the <code class="codehilite">/etc/modules</code> file:
<div class="codehilite"><pre><span></span><span class="gp">#</span> sudo vim /etc/modules
</pre></div>
Add the following line at the end of the file:
<div class="codehilite"><pre><span></span>ipv6
</pre></div>
After a reboot you can check if your Raspberry now has an IPv6 address by calling the statement <code class="codehilite">ip a</code>. To make sure that your SSH client also accepts connections via IPv6 and not only via IPv4, we have to adjust the corresponding config file:
<div class="codehilite"><pre><span></span><span class="gp">#</span> sudo vim /etc/ssh/sshd_config
</pre></div>
Look for a line that begins with <code class="codehilite">AddressFamily</code> and make sure it is not set to <code class="codehilite">inet</code> (IPv4 use only). You can decide if you would like to enable IPv4 and IPv6 connections (by using <code class="codehilite">any</code>), or if you go for IPv6 connections only (<code class="codehilite">inet6</code>). I decided to enable both communication protocols, so that my line looks like this:
<div class="codehilite"><pre><span></span>AddressFamily any
</pre></div>
If you like, you can also disable password authentification for SSH access, this would improve security by forcing clients to use SSH-keys instead. For further instructions on how to setup SSH-keys take a look <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/passwordless.md">here</a>. To disable password authentification just set the following line in your <code class="codehilite">sshd_config</code>:
<div class="codehilite"><pre><span></span>PasswordAuthentication no
</pre></div></p>
<h2 id="router-settings">Router settings<a class="headerlink" href="#router-settings" title="Permanent link">&para;</a></h2>
<p>To make sure your internet router also works with IPv6 DS Lite and that it assigns global IPv6 addresses to your local devices (including your Raspberry Pi), some adjustments might have to be made <em>(Note: These settings depend on the router you use. I'm using an AVM Fritzbox, whose configuration can differ from your router)</em>.
At first I make sure my router uses a native IPv6-connection instead of IPv4 tunneling for IPv6 connectivity by setting the following in <strong>Internet -&gt; Zugangsdaten -&gt; IPv6</strong>:
<img alt="Image" src="../images/ssh6_zugangsdatenIPv6.png" />
Afterwards we configure our DHCPv6 server in <strong>Netzwerk -&gt; Netzwerkeinstellungen -&gt; IPv6 Adressen</strong>, so that it assigns IPv6 addresses from your address range to the devices you are port forwarding, making them directly addressable from the internet:
<img alt="Image" src="../images/ssh6_dhcpv6.png" />
<strong>TODO: Describe port forwarding</strong>
At this point you should be able to connect to your Raspberry Pi from the internet via SSH using the following command:
<div class="codehilite"><pre><span></span><span class="gp">#</span> ssh -6 &lt;user&gt;@&lt;global ipv6&gt;
</pre></div></p>
<h2 id="configure-dynamic-dns-optional">Configure Dynamic DNS (optional)<a class="headerlink" href="#configure-dynamic-dns-optional" title="Permanent link">&para;</a></h2>
<p>By configuring DynDNS you can connect to your Raspberry by using a hostname instead of the complete IPv6 address. I'm using a hostname from <a href="https://dynv6.com">dynv6.com</a> as they support IPv6, but of course you are free to choose a different service. After creating a hostname we have to make sure the hostname is always pointing at the current IPv6 address of the Pi. Therefor I wrote a small script based on a script from <a href="https://dynv6.com">dynv6.com</a>:
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/sh -e</span>
<span class="nv">hostname</span><span class="o">=</span>&lt;yourhostname&gt;
<span class="nv">device</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">token</span><span class="o">=</span>&lt;yourtoken&gt;
<span class="nv">file</span><span class="o">=</span><span class="nv">$HOME</span>/.dynv6.addr6
<span class="o">[</span> -e <span class="nv">$file</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nv">old</span><span class="o">=</span><span class="sb">`</span>cat <span class="nv">$file</span><span class="sb">`</span>

<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$netmask</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">netmask</span><span class="o">=</span><span class="m">128</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">device</span><span class="o">=</span><span class="s2">&quot;dev </span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="k">fi</span>
<span class="nv">address</span><span class="o">=</span><span class="k">$(</span>ip -6 addr list scope global <span class="nv">$device</span> <span class="p">|</span> grep -v <span class="s2">&quot; fd&quot;</span> <span class="p">|</span> sed -n <span class="s1">&#39;s/.*inet6 \([0-9a-f:]\+\).*/\1/p&#39;</span> <span class="p">|</span> head -n <span class="m">1</span><span class="k">)</span>

<span class="k">if</span> <span class="o">[</span> -e /usr/bin/curl <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">bin</span><span class="o">=</span><span class="s2">&quot;curl -fsS&quot;</span>
<span class="k">elif</span> <span class="o">[</span> -e /usr/bin/wget <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">bin</span><span class="o">=</span><span class="s2">&quot;wget -O-&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;neither curl nor wget found&quot;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$address</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;no IPv6 address found&quot;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># address with netmask</span>
<span class="nv">current</span><span class="o">=</span><span class="nv">$address</span>/<span class="nv">$netmask</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$old</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="nv">$current</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;IPv6 address unchanged&quot;</span>
    <span class="nb">exit</span>
<span class="k">fi</span>

<span class="c1"># send addresses to dynv6</span>
<span class="nv">$bin</span> <span class="s2">&quot;http://dynv6.com/api/update?hostname=</span><span class="nv">$hostname</span><span class="s2">&amp;ipv6=</span><span class="nv">$current</span><span class="s2">&amp;token=</span><span class="nv">$token</span><span class="s2">&quot;</span>
<span class="nv">$bin</span> <span class="s2">&quot;http://ipv4.dynv6.com/api/update?hostname=</span><span class="nv">$hostname</span><span class="s2">&amp;ipv4=auto&amp;token=</span><span class="nv">$token</span><span class="s2">&quot;</span>

<span class="c1"># save current address</span>
<span class="nb">echo</span> <span class="nv">$current</span> &gt; <span class="nv">$file</span>
</pre></div>
This script sends the latest IPv4 and IPv6 address to dynv6 if the adresses have changed, so that your hostname always points to the right direction. I have saved the script in my Raspberry Pis home directory in a file called dynv6.sh. Before we proceed, make sure you can execute the script:
<div class="codehilite"><pre><span></span><span class="gp">#</span> chmod +x /path/to/dynv6.sh
</pre></div>
Now we can configure a cronjob that executes the script every 5 minutes, keeping the hostname updated:
<div class="codehilite"><pre><span></span><span class="gp">#</span> crontab -e
</pre></div>
Now add a line that looks like this:
<div class="codehilite"><pre><span></span>*/5 * * * * /path/to/dynv6.sh
</pre></div>
Now you should be able to connect to your Raspberry by using <code class="codehilite">ssh -6 &lt;user&gt;@&lt;your hostname&gt;</code> instead of your IPv6 address only. You can also use your own subdomain name by configuring a CNAME record pointing to the DynDNS hostname in your DNS configuration.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../semihead/" title="Multi-purpose Raspbian setup" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Multi-purpose Raspbian setup
              </span>
            </div>
          </a>
        
        
          <a href="../sshfs/" title="SSHFS hard drive sharing" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                SSHFS hard drive sharing
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019 Sascha Kiesow
          </div>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>